<!doctype html>
<!--
  ~ Copyright 2017 JBoss Inc
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Corner case data in Java</title>
    <meta name="description" content="Introduction to Open Source">
    <link href="file:///home/ge0ffrey/projects/other/ge0ffrey-presentations/usingAndContributingToOpenSource/" rel="canonical">

    <link rel="stylesheet" href="../website/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../website/reveal/css/reveal.min.css">
    <link rel="stylesheet" href="../website/reveal/css/theme/simple.css" id="theme">
    <script>
        if (window.location.search.match(/print-pdf/gi)) {
            document.write('<link rel="stylesheet" href="../website/reveal/css/print/pdf.css">');
        }
    </script>
    <link rel="stylesheet" href="../website/highlight/highlight.css">
    <link rel="stylesheet" href="../website/ge0ffreyPresentation.css">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<div class="reveal">
<div class="watermark watermark-left">
    <p>
        <img src="../common/twitterLogo.png"/>
        @GeoffreyDeSmet
    </p>
</div>
<div class="slides">

    <section>
        <br/>
        <br/>
        <h2>
            0.01 + 0.09 != 0.10
        </h2>
        <p>
            <br/>
            A corner case cheat sheet<br/>
            for Java and JVM languages
        </p>
        <div style="margin-top: 80px;">
            <p>
                <span style="font-size: smaller">by</span> Geoffrey De Smet<br/>
            </p>
        </div>
    </section>

    <section>
        <h3>Who am I?</h3>
        <ul>
            <li>Java developer (graduated in 2003)</li>
            <li>Founder/lead of <b>OptaPlanner</b>
                <ul>
                    <li>Leading Open Source Constraint Solver in Java</li>
                </ul>
            </li>
            <li>Contributor to 23+ Open Source projects</li>
        </ul>
    </section>

    <section>
        <h2>Definition</h2>
        <p style="margin-top: 50px;">
            <i>A <b>corner case</b> is a bug<br/>
            that only manifests itself<br/>
            with a specific combination of input values.</i>
        </p>
        <p class="fragment" style="margin-top: 50px;">
            A <b>corner case cheat sheet</b> is a list of input values<br/>
            that tend to trigger corner cases,<br/>
            useful for automated and manual testing.
        </p>
    </section>

    <section>
        <h2>Numbers</h2>
    </section>

    <section>
        <h3>Average of 2 numbers</h3>
        <pre xml:space="preserve"><code class="java">public int average(int a, int b) {
    double c = (a + b) / 2.0;
    return (int) c;
}</code></pre>
        <p class="fragment">Input</p>
        <pre class="fragment"><code class="java">average(1000, 2000)
<span class="fragment">1500</span></code></pre>
        <pre class="fragment"><code class="java">average(1000000, 2000000)
<span class="fragment">1500000</span></code></pre>
        <pre class="fragment"><code class="java">average(1000000000, 2000000000) <span class="fragment">// Corner case
-647483648 // Overflow on a + b</span></code></pre>
    </section>
    <section>
        <h3>Ariane 5 (1996)</h3>
        <div class="row">
            <div class="col-md-6">
                <figure>
                    <img src="numbers/ariane5LiftOff.gif" style="height: 250px; width: auto;"/>
                    <p>Lift off</p>
                </figure>
            </div>
            <div class="col-md-6 fragment">
                <figure>
                    <img src="numbers/ariane5Crash.jpg" style="height: 250px; width: auto;"/>
                    <p>Overflow</p>
                </figure>
            </div>
        </div>
        <p class="fragment"><i>The horizontal bias variable was unprotected from overflow
            because it was thought that it was "physically limited
            or that there was a large margin of error".</i></p>
    </section>
    <section>
        <h3>Integer overflow</h3>
        <p>Problem</p>
        <pre xml:space="preserve"><code class="java">public int average(int a, int b) {
    double c = (<span class="negative">a + b</span>) / 2.0;
    return (int) c;
}</code></pre>
        <div class="fragment">
        <p>Solution</p>
        <pre xml:space="preserve"><code class="java">public int average(int a, int b) {
    double c = (<span class="positive">(double)</span> a + b) / 2.0;
    return (int) c;
}</code></pre>
        <pre><code class="java">average(1000000000, 2000000000)
1500000000</code></pre>
        </div>
    </section>


    <section>
        <h3>1 and 9 cent</h3>
        <p>Input</p>
        <pre class="fragment"><code class="java">1.0 + 9.0
<span class="fragment">10.0</span></code></pre>
        <pre class="fragment"><code class="java">0.1 + 0.9
<span class="fragment">1.0</span></code></pre>
        <pre class="fragment"><code class="java">0.01 + 0.09 <span class="fragment">// Corner case
0.09999999999999999 // Compound rounding error</span></code></pre>
    </section>
    <section>
        <h3>Failure rate</h3>
        <p>Sum of 2 numbers between 0.00 and 1.00</p>
        <pre><code class="java">
  0.01 + 0.05 != 0.06
  0.01 + 0.06 != 0.07
  0.01 + 0.09 != 0.1
  0.01 + 0.14 != 0.15
  0.01 + 0.17 != 0.18
  0.01 + 0.20 != 0.21
  0.01 + 0.23 != 0.24
  0.01 + 0.28 != 0.29
  ...
  0.99 + 0.87 != 1.86
  0.99 + 0.90 != 1.89
  0.99 + 0.92 != 1.91

2106 failures (21%) out of 10000 sums</code></pre>
        <p><b>Failure rate: 21%</b></p>
    </section>


    <section>
        <h2>Cheat sheet</h2>
        <table>
            <tr>
                <th>Expression</th>
                <th>Actual result</th>
            </tr>
            <tr>
                <td>1000000000 + 2000000000</td>
                <td>-1294967296</td>
            </tr>
            <tr>
                <td>0.01 + 0.09</td>
                <td>0.09999999999999999</td>
            </tr>
            <tr>
                <td>0.01 + 0.05</td>
                <td>0.060000000000000005</td>
            </tr>
            <tr>
                <td>0.01 + 0.02 + 0.03</td>
                <td>0.06</td>
            </tr>
            <tr>
                <td>0.03 + 0.02 + 0.01</td>
                <td>0.060000000000000005</td>
            </tr>
            <tr>
                <td>(double) 9007199254740993L</td>
                <td>9007199254740992.0</td>
            </tr>
            <tr>
                <td>9007199254740992.0 + 1.0</td>
                <td>9007199254740992.0</td>
            </tr>
            <tr>
                <td>9007199254740992.0 + 3.0</td>
                <td>9007199254740996.0</td>
            </tr>
        </table>
    </section>

    <section>
        <h2>Dates</h2>
    </section>

    <section>
        <h2>Text</h2>
    </section>

    <section>
        <h3>Q &amp; A</h3>
        <table class="links">
            <tr>
                <th>Slides</th>
                <td><a href="https://ge0ffrey.github.io/ge0ffrey-presentations/">ge0ffrey.github.io/ge0ffrey-presentations/</a></td>
            </tr>
            <tr>
                <th>Feedback</th>
                <td><img src="../common/twitterLogo64x64.png"/><a href="https://twitter.com/GeoffreyDeSmet">@GeoffreyDeSmet</a></td>
            </tr>
        </table>
    </section>

</div></div>

    <script src="../website/reveal/js/reveal.min.js"></script>

    <script>
        if (window.location.search.match(/print-pdf/gi)) {
            var slides = document.querySelector('.reveal .slides');
            var excludeFromPrintPdfSlide = slides.querySelector('section.excludeFromPrintPdf');
            slides.removeChild(excludeFromPrintPdfSlide);
        }
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: false,
            theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
            transition: Reveal.getQueryHash().transition || 'linear', // page/linear/fade/none

            margin: 0.05,
            minScale: 0.2,
            maxScale: 100.0
        });
    </script>
    <script src="../website/highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
